{"expireTime":9007200873189661000,"key":"transformer-remark-markdown-html-57542aad6e3de5df6faeee65b2663113-gatsby-remark-imagesgatsby-remark-external-linksgatsby-remark-prismjs-","val":"<h1>usando PassportJS en NODE</h1>\n<ul>\n<li>\n<h2>requerimientos instalacion</h2>\n</li>\n<li>\n<p>listado packages npm</p>\n<ul>\n<li>\n<pre>\npassport\npassport-google-oauth20\n</pre>\n</li>\n</ul>\n</li>\n<li>\n<p>complementos</p>\n<ul>\n<li><a href=\"http://www.passportjs.org/packages/passport-google-oauth20/\" target=\"_blank\" rel=\"nofollow\">documentacion de passportJS</a>  </li>\n</ul>\n</li>\n<li>\n<p>paso 1 en el proyecto</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm i passport passport-google-oauth20</code></pre></div>\n</li>\n<li>\n<p>paso 2 en el navegador web</p>\n<ol>\n<li>ingresar a <a href=\"https://console.developers.google.com/\" target=\"_blank\" rel=\"nofollow\">Developer Console de Google</a></li>\n<li>crear PROYECTO ejemplo <strong>passportjs-practicaoauth2</strong> </li>\n<li>ingresa a <strong>Credentials</strong> y asegurate de tener seleccionado tu aplicacion</li>\n<li>ir a <strong>CONFIGURAR PANTALLA DE CONSENTIMIENTO</strong> O <strong>CONFIGURE CONSENT SCREEN</strong></li>\n<li>Marcar opciones [User type : EXTERNAL] y \"CREAR\"</li>\n<li>asignar:\na. nombre a la app <strong>passportjs-practicaoauth2</strong>\nb. correo a la app para asistencias\nc. correo del developer y \"Guardar y continuar\"</li>\n<li>Regresar a <strong>Credentials</strong> e ir a <strong>create credentials</strong> selecciona <strong>OAUTH client ID</strong>\na. selecciona tipo de aplicacion : \"aplicacion web\"\nb. nombre  <strong>passportjs-practicaoauth2</strong>\nc. URI de redireccionamiento autorizados : <strong><a href=\"http://localhost:3000/google/callback\" target=\"_blank\" rel=\"nofollow\">http://localhost:3000/google/callback</a></strong></li>\n<li>Ahora recibes tus datos de acceso!\na. tu ID CLIENTE: 416807314987-n43k7d1bqo7mbspglqsdqousk4vcfmhk.apps.googleusercontent.com\nb. tu ID secreto del CLIENTE: saXjPDAmNtVWVZfIEHxq3BRd</li>\n</ol>\n</li>\n<li>paso 3 en el proyecto</li>\n</ul>\n<p>new file authenticate.js en la raiz</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var passport = require(&#39;passport&#39;)\nvar GoogleStrategy = require(&#39;passport-google-oauth20&#39;).Strategy;\n//import passport from &#39;passport&#39;\n//import GoogleStrategy from &quot;passport-google-oauth20&quot;;\n//const Google = GoogleStrategy.Strategy; \n\n\n/*serializacion de datos*/\npassport.serializeUser(function(user, done) {\n  done(null, user);\n});\n\npassport.deserializeUser(function(user, done) {\n  done(null, user);\n});\n/*basic configure*/\npassport.use(new GoogleStrategy({\n    clientID: &quot;416807314987-n43k7d1bqo7mbspglqsdqousk4vcfmhk.apps.googleusercontent.com&quot;,\n    clientSecret: &quot;saXjPDAmNtVWVZfIEHxq3BRd&quot;,\n    callbackURL: &quot;http://localhost:3000/google/callback&quot;\n  },\n  function(accessToken, refreshToken, profile, cb) {\n      /*Usuario Registrados*/\n      console.log(profile);\n      cb(null,profile)\n\n  }\n));</code></pre></div>\n<p>en app.js importar </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">var passport = require(&#39;passport&#39;)// necesario\n//import passport from &#39;passport&#39;;</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/*revisando passport*/\napp.use(passport.initialize())\nrequire(&#39;./authenticate&#39;);\napp.get(&#39;/google&#39;, passport.authenticate(&#39;google&#39;, { scope: [&#39;profile&#39;, &#39;email&#39;] }));\napp.get(&#39;/google/callback&#39;,    passport.authenticate(&#39;google&#39;, {\n      successRedirect: &#39;/welcome&#39;,\n      failureRedirect: &#39;/failed&#39;,\n    }));\n\n\n\n\n </code></pre></div>\n<p>probar alguna ruta\nir a <a href=\"http://localhost:3000/google\" target=\"_blank\" rel=\"nofollow\">http://localhost:3000/google</a> :D</p>\n<h1>fin</h1>\n<h1>luego de login creado</h1>\n<p><strong>debe ser accesible solo para los que esten logeados</strong></p>\n<p>1- crear MIDDLEWARE/proteccion check is logged or not</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export function isLogged(req, res, next) { // revisa\n  req.user ? next() : res.sendStatus(401); // revisa google trae usuario\n}</code></pre></div>\n<p>2- usar sessions , npm i express-session</p>\n<ul>\n<li>\n<p>key , inicializa , inicializa session </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">app.use(session({ secret: &#39;boby&#39; })); // set my session key\napp.use(passport.initialize()); // session start\napp.use(passport.session()); // session for passport</code></pre></div>\n</li>\n</ul>"}